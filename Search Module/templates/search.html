<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tìm kiếm sản phẩm</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <h1 class="mb-4">Tìm kiếm sản phẩm</h1>

    <!-- FORM SEARCH + LỌC -->
    <form method="POST" class="mb-4">
        <div class="row g-2 align-items-center">
            <!-- Trường tìm kiếm -->
            <div class="col-md-5">
                <input type="text" name="search" class="form-control" 
                    placeholder="Nhập tên sản phẩm..." 
                    value="{{ search_text }}">
            </div>

            <!-- Lọc khoảng cách -->
            <div class="col-md-3">
                <select name="distance_filter" class="form-select">
                    <option value="">Khoảng cách (km)</option>
                    <option value="1" {% if distance_filter=='1' %}selected{% endif %}>Dưới 1 km</option>
                    <option value="3" {% if distance_filter=='3' %}selected{% endif %}>Dưới 3 km</option>
                    <option value="5" {% if distance_filter=='5' %}selected{% endif %}>Dưới 5 km</option>
                    <option value="10" {% if distance_filter=='10' %}selected{% endif %}>Dưới 10 km</option>
                </select>
            </div>

            <!-- Lọc giá -->
            <div class="col-md-3">
                <select name="price_filter" class="form-select">
                    <option value="">Chọn mức giá</option>
                    <option value="1" {% if price_filter=='1' %}selected{% endif %}>Dưới 50000 VNĐ</option>
                    <option value="2" {% if price_filter=='2' %}selected{% endif %}>50000 - 100000 VNĐ</option>
                    <option value="3" {% if price_filter=='3' %}selected{% endif %}>100000 - 200000 VNĐ</option>
                    <option value="4" {% if price_filter=='4' %}selected{% endif %}>200000 - 500000 VNĐ</option>
                    <option value="5" {% if price_filter=='4' %}selected{% endif %}>500000 - 1tr VNĐ </option>
                    <option value="6" {% if price_filter=='4' %}selected{% endif %}>Trên 1tr VNĐ</option>
                </select>
            </div>

            <!-- Nút tìm -->
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100">Tìm</button>
            </div>
        </div>
    </form>

    <!-- KẾT QUẢ -->
    {% if results %}
        {% for product in results %}
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">{{ product.name }}</h5>
                    <small>Vị trí: {{ product.location_name }}</small>
                </div>
                <div class="card-body">
                    {% if product.stores %}
                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                            {% for store in product.stores %}
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h6 class="card-title">{{ store.name }}</h6>
                                            <p class="card-text mb-1">
                                                Vĩ độ: {{ store.lat }}, Kinh độ: {{ store.long }}</p>
                                            {% if store.distance_km %}
                                                <p class="card-text">
                                                    Khoảng cách: {{ '%.2f'|format(store.distance_km) }} km</p>
                                            {% else %}
                                                <p class="card-text text-muted">Khoảng cách chưa xác định</p>
                                            {% endif %}
                                            {% if store.raw_cost %}
                                                <p class="card-text">Giá: {{ store.raw_cost }} VNĐ</p>
                                            {% else %}
                                                <p class="card-text text-muted">Không có giá</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted">Không có cửa hàng nào.</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">Không tìm thấy kết quả nào.</p>
    {% endif %}
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
