<!doctype html>
<html lang="vi">

<head>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chi ti·∫øt s·∫£n ph·∫©m - SHOPPY</title>
    <link rel="stylesheet" href="css/product-detail.css">
    <style>
        /* CSS G·ªêC */
        * { box-sizing: border-box; margin: 0; padding: 0 }
        body { font-family: Inter, system-ui, "Segoe UI", Roboto, Arial; line-height: 1.4; color: #333; background: #f0f2f5; animation: pageFadeIn 0.5s ease-in-out; }
        @keyframes pageFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        body.page-fade-out { animation: pageFadeOut 0.5s ease-in-out forwards; }
        @keyframes pageFadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
        
        /* Navbar */
        .breadcrumb { padding: 15px 60px; font-size: 14px; background: #e9ecef; margin-top: 130px; }
        .breadcrumb a { color: #00aaff; text-decoration: none; }
        main { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        /* Cart Popup */
        #cart-popup { display: none; position: fixed; top: 100px; right: 60px; width: 320px; background: white; border: 1px solid #ccc; border-radius: 12px; box-shadow: 0 4px 18px rgba(0, 0, 0, 0.2); padding: 16px; z-index: 2100; }
        .cart-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; max-height: 300px; overflow-y: auto; }
        .cart-item { display: flex; gap: 8px; align-items: center; border-bottom: 1px dotted #eee; padding-bottom: 5px; }
        .cart-item img { width: 54px; height: 40px; object-fit: cover; border-radius: 6px; }
        .qty { display: inline-flex; align-items: center; gap: 6px; }
        .small-btn { padding: 6px 8px; border-radius: 8px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
        .cart-btn { background: #00a2ff; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .cart-btn:hover { background: #1130b9; }
        
        /* Voice Popup */
        @keyframes blink { 0% { opacity: 0.2; } 50% { opacity: 1; } 100% { opacity: 0.2; } }
        #voice_popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; z-index: 9999; }
        .voice-popup-content { background: white; padding: 30px; border-radius: 15px; text-align: center; width: 350px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .listening-dot { font-size: 40px; color: #ff4444; animation: blink 1s infinite; margin: 10px 0; height: 40px; line-height: 40px; }
        
        /* Product Info */
        .product-container { display: flex; flex-wrap: wrap; gap: 30px; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); margin-bottom: 30px; }
        .product-image { flex: 1; min-width: 300px; }
        .product-image img { max-width: 80%; height: auto; border-radius: 8px; border: 1px solid #eee; margin: 0 auto; display: block; }
        .product-info { flex: 1.5; min-width: 400px; }
        .product-info h2 { font-size: 28px; font-weight: 600; }
        .product-info .price { font-size: 26px; font-weight: 700; color: #00aaff; background: #f0f8ff; padding: 10px 15px; border-radius: 6px; margin: 15px 0; }
        .section-title { font-size: 18px; font-weight: 600; color: #333; margin-top: 25px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .product-description { font-size: 15px; color: #555; line-height: 1.6; }
        
        /* Buttons */
        .actions-container { display: flex; flex-wrap: wrap; align-items: center; gap: 20px; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .quantity-selector { display: flex; align-items: center; gap: 6px; }
        .qty-btn, .qty-input { width: 40px; height: 40px; text-align: center; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
        .qty-btn { cursor: pointer; background: #fff; }
        .buttons { display: flex; gap: 10px; }
        .btn-add-cart, .btn-buy-now, .btn-map { padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600; transition: 0.2s; }
        .btn-map { background: #f0f0f0; color: #333; border: 1px solid #ddd; }
        .btn-map:hover { background: #00aaff; color: white; scale: 1.05; }
        .btn-add-cart { background: #eef3ff; color: #00aaff; border: 1px solid #00aaff; }
        .btn-buy-now { background: #00aaff; color: white; }
        @media (max-width: 768px) { #cart-popup { top: 185px; right: 15px; width: calc(100% - 30px); } }

        /* Review CSS (T·ª´ Doc 4) */
        .reviews-section { background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .review-header { display: flex; align-items: center; justify-content: flex-start; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .review-list { display: flex; flex-direction: column; gap: 20px; }
        .review-item { display: flex; gap: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; }
        .review-avatar { width: 40px; height: 40px; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; overflow: hidden; font-size: 18px; }
        .review-content h4 { font-size: 14px; margin-bottom: 4px; font-weight: 600; }
        .review-content .stars { color: #ffc107; font-size: 14px; margin-bottom: 8px; }
        .review-content p { font-size: 14px; color: #555; }
        .review-content .date { font-size: 12px; color: #999; margin-top: 5px; }

        .review-form { margin-top: 30px; background: #f9f9f9; padding: 20px; border-radius: 8px; }
        .star-rating-input { display: flex; gap: 5px; font-size: 24px; color: #ddd; cursor: pointer; margin-bottom: 15px; flex-direction: row-reverse; justify-content: flex-end; }
        .star-rating-input input { display: none; }
        .star-rating-input label { transition: color 0.2s; }
        .star-rating-input label:hover, .star-rating-input label:hover ~ label, .star-rating-input input:checked ~ label { color: #ffc107; }
        .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; resize: vertical; min-height: 80px; }
        .btn-submit-review { background: #00aaff; color: white; border: none; padding: 10px 20px; border-radius: 6px; margin-top: 10px; cursor: pointer; font-weight: 600; }
        .btn-submit-review:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>

<body>
    <header class="navbar">
        <div class="navbar-top">
            <div class="nav-links-left">
                <a href="#">K√™nh Ng∆∞·ªùi B√°n</a><span>|</span><a href="#">K·∫øt n·ªëi</a>
            </div>
            <div class="nav-links-right" style="display: flex; align-items: center; gap: 12px;">
                <a href="#">üîî Th√¥ng b√°o</a><a href="#">‚ùì H·ªó Tr·ª£</a>
                <a href="#" class="auth-link" id="account-link" onclick="window.location.href='account.html'">T√†i Kho·∫£n</a>
                <div id="logout-link" title="ƒêƒÉng Xu·∫•t" style="margin-left: 8px; cursor: pointer; display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#FFFFFF"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-240-56-56 94-94H440v-80h238l-94-94 56-56 200 200-200 200Z" /></svg>
                </div>
            </div>
        </div>
        <div class="navbar-main">
            <div class="nav-left">
                <a href="index.html" class="brand-link">
                    <img src="images/logo/logo1.png" alt="Logo" class="brand-logo">
                    <div class="brand">SHOPPY</div>
                </a>
            </div>
            <div class="nav-center-search">
                <form id="search_form" onsubmit="event.preventDefault();">
                    <div class="search-icon-left" title="B·ªô l·ªçc t√¨m ki·∫øm" onclick="toggleFilterMenu()">
                         <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M440-160q-17 0-28.5-11.5T400-200v-240L168-736q-15-20-4.5-42t36.5-22h560q26 0 36.5 22t-4.5 42L560-440v240q0 17-11.5 28.5T520-160h-80Zm40-308 198-252H282l198 252Zm0 0Z" /></svg>
                    </div>
                    <input type="text" name="search" id="search_input" placeholder="T√¨m ki·∫øm tr√™n Shoppy..." autocomplete="off" />
                    <div class="search-actions-right">
                         <button type="button" onclick="startVoiceSearch()" class="icon-btn" title="T√¨m b·∫±ng gi·ªçng n√≥i">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M480-400q-50 0-85-35t-35-85v-240q0-50 35-85t85-35q50 0 85 35t35 85v240q0 50-35 85t-85 35Zm0-240Zm-40 520v-123q-104-14-172-93t-68-184h80q0 83 58.5 141.5T480-320q83 0 141.5-58.5T680-520h80q0 105-68 184t-172 93v123h-80Zm40-360q17 0 28.5-11.5T520-520v-240q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240q0 17 11.5 28.5T480-480Z" /></svg>
                         </button>
                         <button type="submit" class="icon-btn search-submit" title="T√¨m ki·∫øm">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1867f8"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" /></svg>
                         </button>
                    </div>
                </form>
            </div>
             <div class="nav-right">
                <button class="cart-btn-icon" id="open-cart">
                    <svg xmlns="http://www.w3.org/2000/svg" height="26px" viewBox="0 -960 960 960" width="26px" fill="white"><path d="M280-80q-33 0-56.5-23.5T200-160q0-33 23.5-56.5T280-240q33 0 56.5 23.5T360-160q0 33-23.5 56.5T280-80Zm400 0q-33 0-56.5-23.5T600-160q0-33 23.5-56.5T680-240q33 0 56.5 23.5T760-160q0 33-23.5 56.5T680-80ZM246-720l96 200h280l110-200H246Zm-38-80h590q23 0 35 20.5t1 41.5L692-482q-11 20-29.5 31T622-440H324l-44 80h480v80H280q-45 0-68-39.5t-2-78.5l54-98-144-304H40v-80h130l38 80Zm134 280h280-280Z" /></svg>
                    <span class="cart-count-bubble" id="cart-count" style="display: none;">0</span>
                </button>
            </div>
        </div>
    </header>

    <nav class="breadcrumb">
        <a href="index.html">Trang ch·ªß</a> / 
        <span id="breadcrumb-summary-link"></span> / 
        <span>Chi ti·∫øt c·ª≠a h√†ng</span>
    </nav>

    <main>
        <div class="product-container">
            <div class="product-image"><img id="product-image-main" src="" alt="·∫¢nh s·∫£n ph·∫©m"></div>
            <div class="product-info">
                <h2 id="product-name">ƒêang t·∫£i...</h2>
                <div id="product-subtitle" style="margin-bottom: 15px; color: #555;"></div>
                <div class="price" id="product-price">0</div>
                <h3 class="section-title">M√¥ t·∫£ s·∫£n ph·∫©m</h3>
                <p class="product-description" id="product-description">ƒêang t·∫£i m√¥ t·∫£...</p>
                
                <div class="actions-container">
                    <div class="quantity-selector">
                        <span>S·ªë L∆∞·ª£ng</span>
                        <button class="qty-btn" id="qty-minus">-</button>
                        <input type="text" class="qty-input" id="qty-input" value="1" readonly>
                        <button class="qty-btn" id="qty-plus">+</button>
                    </div>
                    <div class="buttons">
                        <button class="btn-add-cart" id="add-to-cart-btn">Th√™m v√†o gi·ªè h√†ng</button>
                        <button class="btn-map" id="map-btn">Ch·ªâ ƒë∆∞·ªùng</button>
                        <button class="btn-buy-now" id="buy-now-btn">Mua ngay</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="reviews-section">
            <div class="review-header">
                <h3 style="margin: 0;">ƒê√°nh gi√° s·∫£n ph·∫©m</h3>
                <div id="review-stats" style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
                    <span style="color:#999; font-style: italic;">(ƒêang t·∫£i...)</span>
                </div>
            </div>
            
            <div id="reviews-list" class="review-list">
                <p style="color:#777; font-style: italic;">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o.</p>
            </div>

            <div id="review-form-container" class="review-form" style="display: none;">
                <h4 style="margin-bottom: 15px;">Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n</h4>
                <div class="star-rating-input">
                    <input type="radio" id="star5" name="rating" value="5"><label for="star5" title="5 sao">‚òÖ</label>
                    <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="4 sao">‚òÖ</label>
                    <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="3 sao">‚òÖ</label>
                    <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="2 sao">‚òÖ</label>
                    <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="1 sao">‚òÖ</label>
                </div>
                <div class="form-group">
                    <textarea id="review-comment" placeholder="Chia s·∫ª c·∫£m nh·∫≠n c·ªßa b·∫°n v·ªÅ s·∫£n ph·∫©m n√†y..."></textarea>
                </div>
                <button class="btn-submit-review" id="btn-submit-review">G·ª≠i ƒë√°nh gi√°</button>
            </div>
            <div id="login-prompt" style="margin-top: 20px; color: #666; display:none; text-align: center;">
                Vui l√≤ng <a href="login.html" style="color:#00aaff; font-weight: bold;">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ vi·∫øt ƒë√°nh gi√°.
            </div>
        </div>
    </main>
    
    <div id="cart-popup">
        <h3 style="margin-top:0;">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h3>
        <div class="cart-list" id="cart-list">
            <div style="color:#888">Gi·ªè h√†ng tr·ªëng</div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
            <div>T·ªïng:</div>
            <div style="font-weight:700" id="cart-total">0‚Ç´</div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
            <button class="cart-btn" id="checkout">Thanh to√°n</button>
            <button class="small-btn" id="clear-cart">X√≥a</button>
            <button class="small-btn" id="close-cart" style="margin-left:auto;">ƒê√≥ng</button>
        </div>
    </div>
    
    <div id="voice_popup" style="display:none;">
        <div class="voice-popup-content">
            <h5>üéôÔ∏è ƒêang nghe...</h5>
            <p>H√£y n√≥i t·ª´ kh√≥a t√¨m ki·∫øm c·ªßa b·∫°n</p>
            <p id="transcript_display" style="min-height: 25px; color: #1867f8; font-weight: bold; margin: 15px 0;"></p>
            <div class="listening-dot">‚Ä¢</div>
            <button type="button" onclick="cancelVoiceSearch()" style="padding:10px 20px; background:#666; color:white; border:none; border-radius:8px; cursor:pointer; margin-top:10px;">H·ªßy</button>
        </div>
    </div>

    <footer>
        <div class="footer">
            <div class="footer-section">
                <div class="footer-logo">
                    <h2 style="color:#00aaff; font-size:28px;">SHOPPY</h2>
                    <p style="color:#ccc;">Web b√°n h√†ng h√†ng ƒë·∫ßu Vi·ªát Nam.</p>
                </div>
                <h3>ƒê·ªëi t√°c thanh to√°n</h3>
                <div class="partners"><img src="images/payment/visa.png" alt="Visa"><img src="images/payment/mastercard.png" alt="Mastercard"><img src="images/payment/momo.png" alt="MoMo"></div>
            </div>
            <div class="footer-section">
                <h3>V·ªÅ Shoppy</h3>
                <ul>
                    <li><a href="#">Gi·ªõi thi·ªáu</a></li>
                    <li><a href="#">Li√™n h·ªá</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">@ 2025 Shoppy ‚Äî Khoa CNTT, HCMUS</div>
    </footer>
    
    <script src="js/supabase-init.js"></script>
    <script src="js/product-detail.js"></script>
</body>
</html>