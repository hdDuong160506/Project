<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test GPS App</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        button { font-size: 16px; padding: 10px; }
        #results { margin-top: 20px; font-weight: bold; color: blue; }
    </style>
</head>
<body>

    <h1>Test chức năng gợi ý theo GPS</h1>
    <button id="find-button">Tìm đặc sản quanh đây!</button>
    <div id="results"></div>

    <script>
        // Lấy các phần tử trên trang
        const findButton = document.getElementById('find-button');
        const resultsDiv = document.getElementById('results');

        // Gắn sự kiện "click" cho nút bấm
        findButton.addEventListener('click', () => {
            resultsDiv.innerHTML = "Đang tìm vị trí của bạn...";

            if (!"geolocation" in navigator) {
                resultsDiv.innerHTML = "Trình duyệt không hỗ trợ GPS.";
                return;
            }

            // 1. Dùng API trình duyệt để LẤY TỌA ĐỘ
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;

                    resultsDiv.innerHTML = `Tìm thấy tọa độ: ${latitude}, ${longitude}.<br>Đang gửi lên server...`;

                    // 2. GỌI API PYTHON (Backend)
                    //    Đây chính là địa chỉ server Flask của bạn
                    fetch('http://127.0.0.1:5000/api/suggest-products', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ latitude, longitude }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        // 3. Hiển thị kết quả server trả về
                        if(data.error) {
                            resultsDiv.innerHTML = `Lỗi từ server: ${data.error}`;
                        } else {
                            resultsDiv.innerHTML = `Server xác định bạn đang ở: <strong>${data.found_location}</strong>
                                <p>Sản phẩm gợi ý:</p>
                                <ul>
                                    ${data.suggested_products.map(p => `<li>${p}</li>`).join('')}
                                </ul>`;
                        }
                    })
                    .catch(error => {
                        resultsDiv.innerHTML = `Lỗi khi gọi server Python: ${error}`;
                    });
                },
                (error) => {
                    // Xử lý khi người dùng từ chối chia sẻ vị trí
                    resultsDiv.innerHTML = `Lỗi GPS: ${error.message}`;
                }
            );
        });
    </script>

</body>
</html>